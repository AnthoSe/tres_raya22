<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Evaluar √öltima Jugada - Tres en Raya IA</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="/static/css/evaluar.css" />
  </head>
  <body>
    <!-- Botones fijos -->
    <button
      class="btn btn-secondary btn-back"
      onclick="window.location.href='/'"
    >
      ‚Üê Inicio
    </button>
    <button class="btn btn-outline-info rubrica-btn" onclick="toggleRubrica()">
      üìò Ver R√∫brica
    </button>

    <!-- Panel lateral de r√∫brica -->
    <div class="rubrica-panel" id="rubricaPanel">
      <button class="btn btn-sm btn-light btn-close" onclick="toggleRubrica()">
        ‚úï
      </button>
      <h2>R√∫brica de Evaluaci√≥n</h2>
      <table class="table table-bordered">
        <thead class="table-light">
          <tr>
            <th>Dimensi√≥n</th>
            <th>Nivel 1</th>
            <th>Nivel 2</th>
            <th>Nivel 3</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Comprensi√≥n de Reglas</td>
            <td>Viola reglas b√°sicas</td>
            <td>Cumple reglas b√°sicas</td>
            <td>Siempre legal</td>
          </tr>
          <tr>
            <td>Validez y Legalidad</td>
            <td>Movimiento inv√°lido</td>
            <td>V√°lido, sin an√°lisis</td>
            <td>V√°lido y analizado</td>
          </tr>
          <tr>
            <td>Razonamiento Estrat√©gico</td>
            <td>Sin l√≥gica</td>
            <td>Intenci√≥n simple</td>
            <td>Justificaci√≥n anticipada</td>
          </tr>
          <tr>
            <td>Factualidad</td>
            <td>Explicaci√≥n incorrecta</td>
            <td>Correcta, imprecisa</td>
            <td>Basada en hechos concretos</td>
          </tr>
          <tr>
            <td>Coherencia Explicativa</td>
            <td>Confusa</td>
            <td>Clara pero superficial</td>
            <td>L√≥gica y completa</td>
          </tr>
          <tr>
            <td>Claridad Ling√º√≠stica</td>
            <td>Errores graves</td>
            <td>Peque√±os errores</td>
            <td>Gram√°tica precisa</td>
          </tr>
          <tr>
            <td>Adaptabilidad</td>
            <td>Ignora jugada previa</td>
            <td>Adaptaci√≥n b√°sica</td>
            <td>Se adapta eficazmente</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="container">
      <h1>Evaluar √öltima Jugada</h1>

      {% if jugada %}
      <p class="text-center fw-semibold mb-3" style="font-size: 1.2rem">
        √öltima jugada.
      </p>

      <div id="tablero-dinamico" class="mt-3 mb-3"></div>

      <div
        id="info-jugada"
        aria-live="polite"
        style="margin-top: 1rem; font-size: 1.2rem"
        class="mb-4 mt-4 text-center"
      >
        INFO DE LA JUGADA: Cargando...
      </div>

      <div class="d-flex gap-3 flex-wrap">
        <form
          action="/guardar_evaluacion"
          method="POST"
          class="flex-grow-1"
          style="font-size: 1.2rem"
          onsubmit="return validarFormulario()"
        >
          <input type="hidden" name="match_id" value="{{ jugada.match_id }}" />
          <input type="hidden" name="jugador" value="{{ jugada.jugador }}" />
          <input type="hidden" name="modelo" value="{{ jugada.modelo }}" />
          <input
            type="hidden"
            name="movimiento"
            value="{{ jugada.movimiento | tojson | safe }}"
          />

          <h4 class="mb-3">Evaluaci√≥n por R√∫brica</h4>

          {% set dimensiones = [
            ('Comprensi√≥n de Reglas', '¬øEl movimiento respeta las reglas b√°sicas del juego?'),
            ('Validez y Legalidad', '¬øEs un movimiento permitido y legal?'),
            ('Razonamiento Estrat√©gico', '¬øSe nota una intenci√≥n estrat√©gica en el movimiento?'),
            ('Factualidad', '¬øLa justificaci√≥n se basa en el estado real del tablero?'),
            ('Coherencia Explicativa', '¬øLa explicaci√≥n tiene sentido con el movimiento realizado?'),
            ('Claridad Ling√º√≠stica', '¬øEst√° bien expresado, sin errores graves?'),
            ('Adaptabilidad', '¬øSe adapta al contexto actual del juego?')
          ] %}

          {% for nombre, descripcion in dimensiones %}
          <div class="mb-4">
            <label class="form-label fw-bold">{{ nombre }}</label>
            <p class="text-muted">{{ descripcion }}</p>
            <div class="form-check form-check-inline">
              <input
                class="form-check-input"
                type="radio"
                name="rubrica[{{ nombre }}]"
                value="1"
                required
              />
              <label class="form-check-label">1 - Bajo</label>
            </div>
            <div class="form-check form-check-inline">
              <input
                class="form-check-input"
                type="radio"
                name="rubrica[{{ nombre }}]"
                value="2"
              />
              <label class="form-check-label">2 - Medio</label>
            </div>
            <div class="form-check form-check-inline">
              <input
                class="form-check-input"
                type="radio"
                name="rubrica[{{ nombre }}]"
                value="3"
              />
              <label class="form-check-label">3 - Alto</label>
            </div>
          </div>
          {% endfor %}

          <div class="mb-3">
            <label for="razon" class="form-label fw-bold"
              >Explicaci√≥n general de la evaluaci√≥n</label
            >
            <textarea
              name="razon"
              id="razon"
              class="form-control"
              rows="4"
              style="font-size: 1.1rem"
              placeholder="Escribe una justificaci√≥n completa..."
            ></textarea>
          </div>

          <button type="submit" class="btn btn-success btn-lg w-100">
            ‚úÖ Guardar Evaluaci√≥n
          </button>
        </form>
      </div>

      <a href="/evaluaciones_historial" class="btn-history mt-4" style="font-size: 1.2rem;">
        üìú Ver historial de evaluaciones
      </a>

      {% else %}
      <p class="text-center fs-5 mt-5">
        No hay jugadas para evaluar a√∫n. Juega primero para generar jugadas.
      </p>
      {% endif %}
    </div>

    <script src="/static/js/evaluar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
